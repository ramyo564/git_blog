---

layout: single
title: " [Django DRF] project (2) "
categories: Django
tag: [Python,"[Django DRF] Project eCommerce RESTful API","[Django DRF] Build : Implementing the Product-Line Model"]
toc: true
toc_sticky: true
author_profile: false
sidebar:

---

# ëª¨ë¸ ë³€ê²½

![](https://i.imgur.com/5ySNHoN.png)

ì´ì „ ëª¨ë¸ì—ì„œ ë‹¬ë¼ì§„ ì ì€ ì œí’ˆì—ì„œëŠ” ì—¬ëŸ¬ ì œí’ˆ ë¼ì¸ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.     
ì˜ˆë¥¼ ë“¤ì–´ í‹°ì…”ì¸ ëŠ” ì—¬ëŸ¬ê°€ì§€ ìƒ‰ìƒì´ë‚˜ ì‚¬ì´ì¦ˆë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.     
ì´ëŸ° ë¶€ë¶„ì€ íŠ¹ì • ì œí’ˆì˜ ì œí’ˆ ë¼ì¸ì´ ëœë‹¤.      
ë˜í•œ ì œí’ˆì„ í™œì„±í™” ë˜ëŠ” ë¹„í™œì„±í™” í•˜ì—¬ is_activeê°€ trueë¡œ ì„¤ì •ëœ ì œí’ˆë§Œ í•„í„°ë§ í•˜ì—¬ ê³ ê°ì—ê²Œ ë³´ì—¬ì¤„ ìˆ˜ ìˆë„ë¡ ì—…ë°ì´íŠ¸ í–ˆë‹¤.

![](https://i.imgur.com/a4iPFC5.png)

```python
pytest
```

![](https://i.imgur.com/lQNvpkj.png)

í„°ë¯¸ë„ì—ì„œ ë˜ ì˜¤ë¥˜ê°€ ë‚¬ëŠ”ë° ì°¾ì•„ë³´ë‹ˆ `__init__.py` ê°€ ë¬¸ì œì˜€ë‹¤.

![](https://i.imgur.com/2yvlZAz.png)

ê·¸ ë™ì•ˆ  `__init__.py`  íŒŒì¼ì„ ë§ˆì£¼ì³¤ì§€ë§Œ ì •í™•íˆëŠ” ëª°ëëŠ”ë° í•œ ì„¸ ë²ˆì¯¤ ë§ˆì£¼ì¹œê±° ê°™ìœ¼ë‹ˆ ì¢€ ë” ì•Œì•„ë³´ê¸° ë¡œ í–ˆë‹¤.

## `__init__.py` ëŠ” ë­˜ê¹Œ?

Python ì—ì„œ `__init__.py` íŒŒì¼ì€ í•´ë‹¹ ë””ë ‰í† ë¦¬ë¥¼ íŒ¨í‚¤ì§€ë¡œ ì¸ì‹í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” íŠ¹ìˆ˜í•œ íŒŒì¼ì´ë‹¤.     
ë””ë ‰í† ë¦¬ì— `__init__.py` íŒŒì¼ì´ ì—†ìœ¼ë©´ Pythonì€ í•´ë‹¹ ë””ë ‰í† ë¦¬ë¥¼ íŒ¨í‚¤ì§€ë¡œ ê°„ì£¼í•˜ì§€ ì•Šê³  ëª¨ë“ˆë¡œ ì²˜ë¦¬í•œë‹¤.     

### ê·¸ëŸ¼ ëª¨ë“ˆê³¼ íŒ¨í‚¤ì§€ëŠ” ë˜ ë­ì§€?

- ëª¨ë“ˆ
	- Python ì½”ë“œê°€ ë‹´ê¸´ íŒŒì¼
	- ë³€ìˆ˜, í•¨ìˆ˜, í´ë˜ìŠ¤, ìƒìˆ˜ë“±ì„ í¬í•¨
	- ë‹¤ë¥¸ Python í”„ë¡œê·¸ë¨ì—ì„œ ëª¨ë“ˆì„ ì„í¬íŠ¸í•´ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
		- ì˜ˆì‹œ -> main.py, random.py, detetime.py ë“±
- íŒ¨í‚¤ì§€
	- íŒ¨í‚¤ì§€ëŠ” ê´€ë ¨ëœ ëª¨ë“ˆë“¤ì„ ë””ë ‰í† ë¦¬ í˜•íƒœë¡œ êµ¬ì„±í•œ ê²ƒ
	- íŒ¨í‚¤ì§€ëŠ” í•˜ë‚˜ ì´ìƒì˜ ëª¨ë“ˆì„ í¬í•¨í•˜ê³  ìˆìœ¼ë©°, í•˜ìœ„ íŒ¨í‚¤ì§€ë¥¼ í¬í•¨í•  ìˆ˜ ìˆë‹¤.
	- íŒ¨í‚¤ì§€ëŠ” ëª¨ë“ˆë“¤ì„ ë…¼ë¦¬ì ìœ¼ë¡œ êµ¬ì¡°í™”í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.
	- íŒ¨í‚¤ì§€ëŠ” `__init__.py` íŒŒì¼ì„ í¬í•¨í•´ì„œ íŒ¨í‚¤ì§€ì„ì„ ë‚˜íƒ€ë‚´ì•¼í•œë‹¤.
		- ì˜ˆì‹œ -> numpy, requests, django ë“±

ì˜ˆë¥¼ ë“¤ì–´ 'math.py' ëŠ” ëª¨ë“ˆì´ë‹¤.      
ì´ ëª¨ë“ˆì„ ë‹¤ë¥¸ Python í”„ë¡œê·¸ë¨ì—ì„œ ì„í¬íŠ¸í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

íŒ¨í‚¤ì§€ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¡œ í‘œí˜„ëœë‹¤.    
ì˜ˆë¥¼ ë“¤ì–´ 'numpy' íŒ¨í‚¤ì§€ëŠ” 'numpy' ë¼ëŠ” ë””ë ‰í† ë¦¬ì— ê´€ë ¨ëœ ëª¨ë“ˆë“¤ì´ í¬í•¨ë˜ì–´ ìˆë‹¤.    
ì´ë ‡ê²Œ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ë©´ ê´€ë ¨ëœ ëª¨ë“ˆë“¤ì„ ê·¸ë£¹í™”í•˜ê³  êµ¬ì¡°ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.     


ë”°ë¼ì„œ ëª¨ë“ˆì€ ê°œë³„ì ì¸ ì½”ë“œ íŒŒì¼ì´ê³ , íŒ¨í‚¤ì§€ëŠ” ê´€ë ¨ëœ ëª¨ë“ˆë“¤ì˜ ì§‘í•©ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.

## Build : Product - Line Serializer

![](https://i.imgur.com/aNmQ4dB.png)

Product ëª¨ë¸ì—ì„œ í…Œì´ë¸”ì´ í•„ìš”í•´ì„œ ì‚¬ìš©í–ˆë˜ FK í‚¤ë¥¼ êµ¬í˜„í•´ì¤€ë‹¤.     
ë³€ìˆ˜ëª…ì€ product ë‹¤.

## Analysis : User Stories

# Appendix B: User Story Analysis

|   |   |
|---|---|
|**Overview**|   |
|**Title**|Customer Product Browsing Behaviour|
|**Description**|Identifying a basic customer behavioural interaction when browsing products|
|**Actors and Interfaces**|Customer / Web User|
|**Initial Status and Preconditions**|Assumption that customer enters from the root/homepage|
|**Basic Flow**|   |
|Step1: Land on the homepage<br><br>Step2: Select a product category<br><br>Step3: Browse, select, and view individual products related to the selected category<br><br>Step4: Select and view individual product-line details|   |
|**Alternative Flow(s)**|   |
|Â§Â  Customers may prefer searching for the product using keyword search features<br><br>Â§Â  Customers may navigate to a product from an internal promotional panel|   |

|               |                 |                                                                             |
| ------------- | --------------- | --------------------------------------------------------------------------- |
| **User Type** | **Activity**    | **User Story**                                                              |
| Web User      | Browse Products | Step1: Land on the homepage                                                 |
|        ''       |          ''       | Step2: Select a product category                                            |
|         ''      |         ''        | Step3: Select and view individual products related to the selected category |
|     ''          |     ''            | Step4: Inspect individual product-line details                              |


|                                                   |            |
| ------------------------------------------------- | ---------- |
| **Functional Specifications**                     | **Status** |
| Return all categories                             |   Check     |
| Return all products filtered by category          |         |
| Return individual product and product-line by (x) |          |


## Build : Category Filter with Extra Actions

[DRF ViewSet](https://www.django-rest-framework.org/api-guide/viewsets/)

### ViewSet vs ModelViewSet

ViewSetì€ í´ë˜ìŠ¤ë¥¼ ìƒì†í•´ì„œ CRUD ê¸°ëŠ¥ì„ ì§ì ‘ êµ¬í˜„í•´ì•¼ í•œë‹¤.     
ë°˜ë©´ ModelViewSetì€ ViewSetì„ í™•ì¥í•´ì„œ ì—°ë™ëœ CRUD ê¸°ëŠ¥ì„ ìë™ìœ¼ë¡œ ì œê³µí•´ì£¼ëŠ” í´ë˜ìŠ¤ë‹¤.    
ë”°ë¼ì„œ ê¸°ë³¸ CRUD ë©”ì„œë“œê°€ ìë™ìœ¼ë¡œ êµ¬í˜„ ë˜ì–´ ìˆê³  í•„í„°ë§, ê²€ìƒ‰, ì •ë ¬ë“±ì˜ ê¸°ëŠ¥ë„ ìë™ìœ¼ë¡œ ì œê³µëœë‹¤.


```python
  
class ProductViewSet(viewsets.ModelViewSet):
Â  Â  '''
Â  Â  A simple Viewset for viewing all products

Â  Â  '''
Â  Â  queryset = Product.objects.all()
Â  Â  @extend_schema(responses=ProductSerializer)
Â  Â  def list(self, request):
Â  Â  Â  Â  serializer = ProductSerializer(self.queryset, many=True)
Â  Â  Â  Â  return Response(serializer.data)
```

![](https://i.imgur.com/zzuBc7Y.png)

ì´ì „ì— GET ê¸°ëŠ¥ ë°–ì— ì—†ë˜ ê²Œ put, delete ë“± ê¸°ë³¸ì ì¸ ê¸°ëŠ¥ë“¤ì´ ìƒê²¼ë‹¤.     

### GenericViewSets or ModelViewSets

[ì°¨ì´ì ](https://stackoverflow.com/questions/25125959/django-rest-framework-generics-or-modelviewsets)

GenericViewSets ì€ GenericAPIView ë¥¼ ìƒì†í•˜ì§€ë§Œ ê¸°ë³¸ ë™ì‘ì˜ êµ¬í˜„ì€ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤.    
get_object, get_queryset ë§Œ ì œê³µí•œë‹¤.

ModelViewSets ì€ GenericAPIView ì— ìƒì†ë˜ë©° ë‹¤ì–‘í•œ êµ¬í˜„ì„ í¬í•¨í•œë‹¤.     
ëª©ë¡, ê²€ìƒ‰, ìƒì„±, ì—…ë°ì´íŠ¸ ë“± ê¸°ë³¸ë™ì‘ì´ ë‹¤ êµ¬í˜„ë˜ì–´ìˆìœ¼ë©° ì»¤ìŠ¤í…€ë„ ê°€ëŠ¥í•˜ë‹¤.     

### ì •ê·œì‹ regex íŒ¨í„´

[íŒŒì´ì¬ ì •ê·œì‹](https://docs.python.org/ko/3/howto/regex.html)

íŒŒì´ì¬ì— ë‚´ì¥ëœ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë‹¤.    

![](https://i.imgur.com/dMgtUIq.png)


íŒŒì´ì¬ì—ì„œ ì •ê·œ í‘œí˜„ì‹(Regular Expression)ì€ í…ìŠ¤íŠ¸ íŒ¨í„´ì„ ê²€ìƒ‰, ì¶”ì¶œ ë˜ëŠ” ëŒ€ì²´í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ê°•ë ¥í•œ ë„êµ¬ë‹¤.       
ì •ê·œ í‘œí˜„ì‹ì€ ë¬¸ìì—´ì—ì„œ íŠ¹ì • íŒ¨í„´ì„ ì‹ë³„í•˜ê³  ì¼ì¹˜í•˜ëŠ” í…ìŠ¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë° ìœ ìš©í•˜ë‹¤.        

íŒŒì´ì¬ì—ì„œëŠ” `re` ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ ì •ê·œ í‘œí˜„ì‹ì„ ì§€ì›í•œë‹¤.       
`re` ëª¨ë“ˆì€ ë‹¤ì–‘í•œ í•¨ìˆ˜ì™€ ë©”ì„œë“œë¥¼ ì œê³µí•˜ì—¬ ë¬¸ìì—´ì— ëŒ€í•œ íŒ¨í„´ ë§¤ì¹­, ê²€ìƒ‰, ì¶”ì¶œ, ëŒ€ì²´ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.      

íŒŒì´ì¬ ì •ê·œ í‘œí˜„ì‹ì€ íŠ¹ìˆ˜í•œ ë¬¸ìì™€ ë©”íƒ€ ë¬¸ìë¥¼ ì‚¬ìš©í•˜ì—¬ íŒ¨í„´ì„ ì •ì˜í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì€ ì •ê·œ í‘œí˜„ì‹ íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆë‹¤

```python
import re

text = "ì´ë©”ì¼ ì£¼ì†ŒëŠ” example@example.comì…ë‹ˆë‹¤."
pattern = r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b'

match = re.search(pattern, text)
if match:
    email = match.group()
    print("ì´ë©”ì¼ ì£¼ì†Œ:", email)
else:
    print("ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

```

ìœ„ì˜ ì˜ˆì œì—ì„œëŠ” `\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b` íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•œë‹¤.      
ì´ ì •ê·œ í‘œí˜„ì‹ì€ ì´ë©”ì¼ ì£¼ì†Œì˜ ì¼ë°˜ì ì¸ í˜•ì‹ì„ ë‚˜íƒ€ë‚´ë©°, ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì°¾ìœ¼ë©´ í•´ë‹¹ ì£¼ì†Œë¥¼ ì¶œë ¥í•œë‹¤.     

ì •ê·œ í‘œí˜„ì‹ì€ ë‹¤ì–‘í•œ íŒ¨í„´ì„ ì •ì˜í•  ìˆ˜ ìˆìœ¼ë©°, í…ìŠ¤íŠ¸ ì²˜ë¦¬ì— ìœ ìš©í•œ ë§ì€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.     
ë”°ë¼ì„œ íŒŒì´ì¬ì—ì„œ ì •ê·œ í‘œí˜„ì‹ì„ ìµíˆê³  í™œìš©í•˜ë©´ í…ìŠ¤íŠ¸ ì²˜ë¦¬ ì‘ì—…ì„ ë”ìš± íš¨ê³¼ì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


```python
from rest_framework.decorators import action

class ProductViewSet(viewsets.ViewSet):
Â  Â  '''
Â  Â  A simple Viewset for viewing all products
Â  Â  '''
Â  Â  queryset = Product.objects.all()

Â  Â  @extend_schema(responses=ProductSerializer)
Â  Â  def list(self, request):
Â  Â  Â  Â  serializer = ProductSerializer(self.queryset, many=True)
Â  Â  Â  Â  return Response(serializer.data)

Â  Â  @action(
Â  Â  Â  Â  methods=["get"],
Â  Â  Â  Â  detail=False,
Â  Â  Â  Â  url_path=r"category/(?P<category>\w+)/all",
Â  Â  Â  Â  url_name="all",
Â  Â  Â  Â  Â  Â  )

Â  Â  def list_product_by_category(self, request, category=None):
Â  Â  Â  Â  '''
Â  Â  Â  Â  An endpoint to return products by category
Â  Â  Â  Â  '''
Â  Â  Â  Â  serializer = ProductSerializer(
Â  Â  Â  Â  Â  Â  self.queryset.filter(category__name=category), many=True
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  return Response(serializer.data)
```

`@action` ì€ DRFì˜ ë°ì½”ë ˆì´í„°ë¡œ ViewSetì— ì‚¬ìš©ì ì •ì˜ ì•¡ì…˜ì„ ì¶”ê°€í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.     
í•´ë‹¹ ì•¡ì…˜ì€ 'list_product_by_category' ë©”ì†Œë“œë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.      

methods ëŠ” 'list_product_by_category' ì•¡ì…˜ì˜ HTTP ë©”ì†Œë“œë¥¼ ì§€ì •í•œë‹¤. ìœ„ì˜ ì˜ˆì‹œì—ëŠ” GET ë©”ì†Œë“œë§Œ í—ˆìš©ë˜ë„ë¡ ì„¤ì •ë˜ì–´ìˆë‹¤.     

detailì€ ì•¡ì…˜ì´ ê°œë³„ ê°œì²´ì— ê°œí•œ ì‘ì—…ì¸ì§€ ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì‘ì—…ì¸ì§€ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.     
detail=Falseë¡œ ì„¤ì •ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì‘ì—…ì´ë‹¤.     

`url_path` ë° `url_name`: ì´ë“¤ì€ ì—”ë“œí¬ì¸íŠ¸ì˜ URL ê²½ë¡œë¥¼ ì •ì˜í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤. ìœ„ì˜ ì˜ˆì‹œì—ì„œëŠ” `category/(?P<category>\w+)/all`ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©°, `(?P<category>\w+)`ëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë™ì  ìš”ì†Œë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. `url_name`ì€ ì´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•œ ì´ë¦„ì„ ì •ì˜í•œë‹¤.

`list_product_by_category` ë©”ì†Œë“œ: ì´ ë©”ì†Œë“œëŠ” ìš”ì²­ê³¼ ì¹´í…Œê³ ë¦¬ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ì•„ë“¤ì´ê³ , í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ì†í•˜ëŠ” ì œí’ˆë“¤ì„ ì¿¼ë¦¬í•˜ì—¬ ì‹œë¦¬ì–¼ë¼ì´ì €ë¥¼ í†µí•´ ì§ë ¬í™”í•œ í›„, ì‘ë‹µìœ¼ë¡œ ë°˜í™˜í•œë‹¤. `ProductSerializer`ëŠ” í•´ë‹¹ ì œí’ˆë“¤ì„ ì§ë ¬í™”í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.

ì¦‰, ìœ„ì˜ ì½”ë“œëŠ” `/category/{category}/all` URLì„ í†µí•´ GET ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ì†í•˜ëŠ” ëª¨ë“  ì œí’ˆë“¤ì„ ë°˜í™˜í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì •ì˜í•˜ê³  ìˆë‹¤.

|                                                   |            |
| ------------------------------------------------- | ---------- |
| **Functional Specifications**                     | **Status** |
| Return all categories                             |   Checked     |
| Return all products filtered by category          |   Checked      |
| Return individual product and product-line by (x) |          |


#### `@action -> detail -> ì»¬ë ‰ì…˜?`

`detail` ë§¤ê°œë³€ìˆ˜ëŠ” Django REST Frameworkì—ì„œ ì‚¬ìš©ë˜ëŠ” ë°ì½”ë ˆì´í„° `@action`ì˜ ì˜µì…˜ ì¤‘ í•˜ë‚˜ë‹¤.     ì´ ì˜µì…˜ì€ ì•¡ì…˜ì´ ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì‘ì—…ì¸ì§€ ê°œë³„ ê°œì²´ì— ëŒ€í•œ ì‘ì—…ì¸ì§€ë¥¼ ì§€ì •í•œë‹¤.     

- ì»¬ë ‰ì…˜(Collection): ì»¬ë ‰ì…˜ì€ ì—¬ëŸ¬ ê°œì²´ë¡œ êµ¬ì„±ëœ ê·¸ë£¹ì´ë‚˜ ëª©ë¡ì„ ì˜ë¯¸í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ëª¨ë“  ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ëŠ” ì—”ë“œí¬ì¸íŠ¸ëŠ” ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì‘ì—…ì´ë‹¤. ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì‘ì—…ì€ ì¼ë°˜ì ìœ¼ë¡œ ëª¨ë“  ê°œì²´ë¥¼ ë°˜í™˜í•˜ê±°ë‚˜ í•„í„°ë§ëœ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.
    
- ê°œë³„ ê°œì²´(Object): ê°œë³„ ê°œì²´ëŠ” ì»¬ë ‰ì…˜ ë‚´ì—ì„œ íŠ¹ì •í•œ ë‹¨ì¼ ê°œì²´ë¥¼ ì˜ë¯¸í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ëŠ” ì—”ë“œí¬ì¸íŠ¸ëŠ” ê°œë³„ ê°œì²´ì— ëŒ€í•œ ì‘ì—…ì´ë‹¤. ê°œë³„ ê°œì²´ì— ëŒ€í•œ ì‘ì—…ì€ ì¼ë°˜ì ìœ¼ë¡œ ê°œì²´ì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ë°˜í™˜í•˜ê±°ë‚˜ ìˆ˜ì •, ì‚­ì œí•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.
    

`detail` ë§¤ê°œë³€ìˆ˜ì˜ ê°’ì— ë”°ë¼ ì•¡ì…˜ì˜ ë™ì‘ì´ ë‹¬ë¼ì§„ë‹¤:

- `detail=False`: `detail=False`ë¡œ ì„¤ì •ëœ ê²½ìš°, ì•¡ì…˜ì€ ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì‘ì—…ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `GET` ìš”ì²­ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¤ëŠ” ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.
    
- `detail=True`: `detail=True`ë¡œ ì„¤ì •ëœ ê²½ìš°, ì•¡ì…˜ì€ ê°œë³„ ê°œì²´ì— ëŒ€í•œ ì‘ì—…ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • ì‚¬ìš©ìë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ìˆ˜ì •í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ URL ê²½ë¡œì— ê°œë³„ ê°œì²´ì˜ ì‹ë³„ìê°€ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤.
    

ì˜ˆë¥¼ ë“¤ì–´, ì•„ë˜ì˜ ì½”ë“œëŠ” ì‚¬ìš©ì ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì•¡ì…˜ê³¼ ê°œë³„ ì‚¬ìš©ìì— ëŒ€í•œ ì•¡ì…˜ì„ ë³´ì—¬ì¤€ë‹¤:

```python
from rest_framework.decorators import action
from rest_framework.response import Response

class UserViewSet(viewsets.ViewSet):
    queryset = User.objects.all()

    @action(detail=False, methods=['get'])
    def list_users(self, request):
        users = self.queryset
        serializer = UserSerializer(users, many=True)
        return Response(serializer.data)

    @action(detail=True, methods=['get'])
    def retrieve_user(self, request, pk=None):
        user = get_object_or_404(self.queryset, pk=pk)
        serializer = UserSerializer(user)
        return Response(serializer.data)

```

ìœ„ì˜ ì˜ˆì‹œì—ì„œ `list_users` ì•¡ì…˜ì€ ëª¨ë“  ì‚¬ìš©ìë¥¼ ë°˜í™˜í•˜ëŠ” ì»¬ë ‰ì…˜ì— ëŒ€í•œ ì‘ì—…ì´ë‹¤. `retrieve_user` ì•¡ì…˜ì€ íŠ¹ì • ì‚¬ìš©ìë¥¼ ì¡°íšŒí•˜ëŠ” ê°œë³„ ê°œì²´ì— ëŒ€í•œ ì‘ì—…ì´ë‹¤. `list_users` ì•¡ì…˜ì€ `detail=False`ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, URLì— ê°œë³„ ì‚¬ìš©ìì˜ ì‹ë³„ìê°€ í•„ìš”í•˜ì§€ ì•Šë‹¤. `retrieve_user` ì•¡ì…˜ì€ `detail=True`ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, URLì— ê°œë³„ ì‚¬ìš©ìì˜ ì‹ë³„ìê°€ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤.

ë”°ë¼ì„œ, `detail` ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¬ë ‰ì…˜ê³¼ ê°œë³„ ê°œì²´ì— ëŒ€í•œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ êµ¬ë¶„í•˜ê³  í•´ë‹¹ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.


### DRFì—ì„œ ì •ê·œ í‘œí˜„ì‹ Regexë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

1. ë™ì ì¸ URL ì²˜ë¦¬: ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë™ì ì¸ URLì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. URLì—ì„œ íŠ¹ì • ë¶€ë¶„ì„ ë™ì ìœ¼ë¡œ ì¶”ì¶œí•˜ê³  í•´ë‹¹ ê°’ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ì¡°íšŒ ë° ì¡°ì‘ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ìì˜ IDë‚˜ ì´ë¦„ê³¼ ê°™ì€ ë™ì ì¸ ê°’ìœ¼ë¡œ ê°œë³„ ì‚¬ìš©ìì— ì ‘ê·¼í•˜ëŠ” ê²½ìš°, ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ URLì„ êµ¬ì„±í•©ë‹ˆë‹¤.
    
2. ìœ íš¨ì„± ê²€ì‚¬: ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ URL í˜•ì‹ì„ ì œí•œí•˜ê³  ìœ íš¨ì„±ì„ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì´ë©”ì¼ ì£¼ì†Œ í˜•ì‹ì´ ìœ íš¨í•œì§€ í™•ì¸í•˜ê±°ë‚˜, ìˆ«ìë¡œ ëœ ID í˜•ì‹ì´ ìš”êµ¬ë˜ëŠ” ê²½ìš°, ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ URL í˜•ì‹ì„ ì œí•œí•˜ê³  ìœ íš¨ì„±ì„ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
3. ìœ ì—°í•œ URL íŒ¨í„´: ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ë©´ ë‹¤ì–‘í•œ URL íŒ¨í„´ì„ ìœ ì—°í•˜ê²Œ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. URLì— ëŒ€í•œ ë‹¤ì–‘í•œ ë§¤ì¹­ ì¡°ê±´ê³¼ í˜•ì‹ì„ ì§€ì •í•  ìˆ˜ ìˆì–´ì„œ, ë‹¤ì–‘í•œ ìš”êµ¬ì‚¬í•­ì„ ì²˜ë¦¬í•˜ê³  ë‹¤ì–‘í•œ URL ê²½ë¡œë¥¼ ì§€ì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
4. ì½”ë“œ ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„±: ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ URLì„ ì •ì˜í•˜ë©´ ì½”ë“œì˜ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì´ í–¥ìƒë©ë‹ˆë‹¤. ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ë©´ ë³µì¡í•œ URL íŒ¨í„´ì„ ê°„ê²°í•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆê³ , ë‹¤ë¥¸ ê°œë°œìë“¤ì´ ì´í•´í•˜ê¸° ì‰¬ìš´ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    

ë”°ë¼ì„œ, DRFì—ì„œ ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ URL íŒ¨í„´ì„ ì •ì˜í•˜ëŠ” ê²ƒì€ ë™ì ì¸ URL ì²˜ë¦¬, ìœ íš¨ì„± ê²€ì‚¬, ìœ ì—°í•œ URL íŒ¨í„´ ë“±ì„ ìœ„í•´ í•„ìš”í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.


## Build : Filter Return Single Product

![](https://i.imgur.com/XtQ0fma.png)

Slug ë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.     
ìŠ¬ëŸ¬ê·¸ëŠ” ê²€ìƒ‰ ì—”ì§„ (SEO) ìµœì í™”ë¥¼ ê°œì„ í•˜ëŠ”ë° ë„ì›€ëœë‹¤.     
ë˜í•œ ë™ì¼í•œ ë‚´ìš©ì„ ê°€ì§„ ì—¬ëŸ¬ ê°œì˜ URLì„ êµ¬ë¶„í•´ ì½˜í…ì¸  ì¤‘ë³µ ë¬¸ì œë¥¼ ë°©ì§€í•˜ê±°ë‚˜ ê²€ìƒ‰ ì—”ì§„ì—ì„œì˜ ë¬¸ì œë¥¼ ìµœì†Œí™” í•  ìˆ˜ ìˆë‹¤.

models.py
![](https://i.imgur.com/08ZsXnR.png)

views.py
![](https://i.imgur.com/tJahe9u.png)

![](https://i.imgur.com/yiw22u7.png)

## Build : Editing Multiple Models in the Django Admin Site

![](https://i.imgur.com/6bhQNPz.png)

TabularInline ì„ ì´ìš©í•´ í•´ë‹¹ ì–´ë“œë¯¼ì„ í•œ êº¼ë²ˆì— ë³´ê²Œ ë§Œë“¤ë ¤ê³  í•œë‹¤.

![](https://i.imgur.com/EYHoZ0H.png)

[ê³µí™ˆ InlineModelAdmin objects ](https://docs.djangoproject.com/en/4.2/ref/contrib/admin/)

admin.py

![](https://i.imgur.com/1THI5EF.png)


![](https://i.imgur.com/fxMLjvr.png)


![](https://i.imgur.com/wVkOZyp.png)

p3 ìœ¼ë¡œ ì¶œë ¥í–ˆì„ ë•Œ ë¸Œëœë“œì™€ ì¹´í…Œê³ ë¦¬, ì œí’ˆì •ë³´ë“±ì„ ë°˜í™˜í•˜ì§€ë§Œ ì œí’ˆ ì¸ë¼ì¸ ì •ë³´ë“¤ì€ ì‹¤ì œë¡œ ë°˜í™˜í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.    
ì‚¬ì‹¤ Serializerì— Productlineì— ëŒ€í•œ ì–´ë– í•œ ì°¸ì¡°ë„ ì—†ë‹¤.     
ì´ ë•Œë¬¸ì— í˜„ì¬ ì‹œì ì—ì„œëŠ” ì œí’ˆ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë”ë¼ë„ ì‹¤ì œë¡œëŠ” í•´ë‹¹ ë°ì´í„°ë¥¼ ì§ë ¬í™” í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ë‹¤.     

![](https://i.imgur.com/SnNIhAV.png)

í˜„ì¬ retrieveë¥¼ ë³´ë©´ ì‹¤í–‰í–ˆë˜ ì¿¼ë¦¬ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.    
ì´ ì¿¼ë¦¬ëŠ” ì œí’ˆì— ëŒ€í•œ ëª¨ë“  ê²ƒì„ ë°˜í™˜í•œë‹¤.    
ì‹¤ì œë¡œëŠ” ì œí’ˆ í…Œì´ë¸”ì—ì„œ ëª¨ë“  ê²ƒì„ ë°˜í™˜í•˜ê³  ìˆë‹¤.    
ì—¬ê¸°ì—ì„œ ê°œë³„ ì œí’ˆì„ í•„í„°ë§í•˜ê¸° ìœ„í•œ í•„ë“œë¥¼ ìƒì„±í•˜ê³  ìˆë‹¤.    
Product í…Œì´ë¸”ì—ì„œ brand ì™€ category ê´€ê³„ë¥¼ ìƒì„±í–ˆê¸° ë•Œë¬¸ì— í•´ë‹¹ ì •ë³´ê°€ ë°˜í™˜ëœë‹¤.
ì´ ë¶€ë¶„ì„ ë‹¤ì‹œ í•´ê²°í•´ ë³´ì


## Build : Handling Reverse Relationships in Serializers

ì´ì „ì— product line ë°ì´í„°ì— ì ‘ê·¼ í•  ìˆ˜ ì—†ì—ˆëŠ”ë° ì™œëƒí•˜ë©´ Product line tableì— ê´€ê³„ì„¤ì •ì´ ë˜ì–´ ìˆì—ˆê¸° ë•Œë¬¸ì´ë‹¤.     
ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì—­ì°¸ì¡°ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.     

models.py      
![](https://i.imgur.com/ZI9AOZE.png)

ì—­ì°¸ì¡°ì—ì„œ ì‚¬ìš©í•  ë³€ìˆ˜ëª…ì„ product_lineìœ¼ë¡œ ì§€ì •í•´ì¤€ë‹¤.     

serializers.py
![](https://i.imgur.com/sF6dKEl.png)

ë‹¤ìˆ˜ì˜ ë°ì´í„°ë¥¼ serialize í™” í•˜ê³ ì í•  ë•Œ many=Tureë¥¼ ì‚¬ìš©í•˜ë©´ëœë‹¤.    ![](https://i.imgur.com/Bo8Aesr.png)

product line ë°ì´í„°ê°€ ì˜ ë“¤ì–´ì˜¨ë‹¤.

## Build : Serializer Field Name Mapping and Flattening 

models.py
![](https://i.imgur.com/SOJynSk.png)

serializers.py
![](https://i.imgur.com/tQPRLTg.png)


![](https://i.imgur.com/sTMS1tM.png)

ìœ„ì™€ ê°™ì´ ë°ì´í„°ë¥¼ ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆë‹¤.

![](https://i.imgur.com/2m8U3yH.png)

ì´ë ‡ê²Œ ì§€ì €ë¶„í•˜ê²Œ ë‚˜ì˜¤ëŠ” ê²ƒë„ ì•„ë˜ì™€ ê°™ì´ ì»¨íŠ¸ë¡¤ ê°€ëŠ¥í•˜ë‹¤.
![](https://i.imgur.com/e7Rx2p0.png)

![](https://i.imgur.com/MvweVgZ.png)

[ë” ìì„¸í•œ ì •ë³´](https://www.django-rest-framework.org/api-guide/relations/)

## Performance : Multiple Queries, Towards Eliminating the N+Query Problem

ì¿¼ë¦¬ë¥¼ ë³´ê¸° ìœ„í•´ì„œëŠ”

```python
from django.db import connection

class ProductViewSet(viewsets.ViewSet):

Â  Â  queryset = Product.objects.all()
Â  Â  lookup_field = "slug"
Â  Â  
Â  Â  def retrieve(self, request, slug=None):
Â  Â  Â  Â  serializer = ProductSerializer(self.queryset.filter(slug=slug), many=True)

		x = Response(serializer.data)
Â  Â  Â  Â  print(connection.queries)

Â  Â  Â  Â  return x

```

![](https://i.imgur.com/znEmeTp.png)


ì´ëŸ° ì‹ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆì§€ë§Œ ë§¤ìš° ì§€ì €ë¶„í•˜ë‹¤.     

```python
pip install sqlparse
pip install Pygments
```

https://pypi.org/project/sqlparse/
https://pypi.org/project/Pygments/

ìœ„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°„ë‹¨í•˜ê²Œ ì†Œê°œí•˜ìë©´    
### sqlparse & Pygments

#### **sqlparse:** 
`sqlparse`ëŠ” SQL ë¬¸ì„ íŒŒì‹±í•˜ê³  ë¶„ì„í•˜ê¸° ìœ„í•œ í¸ë¦¬í•œ ë°©ë²•ì„ ì œê³µí•˜ëŠ” Python ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤.      

ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” SQL ì¿¼ë¦¬ì™€ ë¬¸ì¥ì„ êµ¬ì¡°í™”ëœ í˜•ì‹ìœ¼ë¡œ íŒŒì‹±í•˜ì—¬ SQL ì½”ë“œë¥¼ í”„ë¡œê·¸ë˜ë°ì ìœ¼ë¡œ ë‹¤ë£¨ê³  ì¡°ì‘í•˜ëŠ” ë° ì‚¬ìš©í•œë‹¤.     

`sqlparse`ëŠ” ë‹¤ì–‘í•œ SQL ë°©ì–¸ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, í…Œì´ë¸”, ì—´, í‚¤ì›Œë“œ ë“±ì˜ ì •ë³´ë¥¼ SQL ë¬¸ì—ì„œ ì¶”ì¶œí•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.     

ë˜í•œ ì ì ˆí•œ ë“¤ì—¬ì“°ê¸°ì™€ ê°œí–‰ì„ ì¶”ê°€í•˜ì—¬ SQL ì½”ë“œë¥¼ ì„œì‹í™”í•  ìˆ˜ ìˆë‹¤.      `sqlparse`ëŠ” SQL í¸ì§‘ê¸°, ì½”ë“œ ìƒì„±ê¸°, ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ë„êµ¬ ë“±ì—ì„œ ë™ì ìœ¼ë¡œ SQL ì½”ë“œë¥¼ ë¶„ì„í•˜ê±°ë‚˜ ìˆ˜ì •í•´ì•¼ í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©í•œë‹¤.

ë‹¤ìŒì€ `sqlparse`ë¥¼ ì‚¬ìš©í•˜ì—¬ SQL ë¬¸ì„ íŒŒì‹±í•˜ê³  ì„œì‹í™”í•˜ëŠ” ì˜ˆì œë‹¤:

```python
import sqlparse

sql = "SELECT * FROM customers WHERE age > 18;"
parsed = sqlparse.parse(sql)
formatted = sqlparse.format(parsed[0], reindent=True, keyword_case='upper')
print(formatted)
****
```

Result
```python
SELECT *
FROM customers
WHERE age > 18;
```

`sqlparse`ë¥¼ ì‚¬ìš©í•˜ì—¬ SQL ë¬¸ì´ íŒŒì‹±ë˜ê³  ì ì ˆí•œ ë“¤ì—¬ì“°ê¸°ì™€ ëŒ€ë¬¸ìí™”ê°€ ì ìš©ëœ ì„œì‹í™”ëœ SQL ì½”ë“œê°€ ì¶œë ¥ëœë‹¤.

#### **Pygments:** 
`Pygments`ëŠ” ê°•ë ¥í•œ êµ¬ë¬¸ ê°•ì¡°(ë¬¸ë²• ê°•ì¡°) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´, ë§ˆí¬ì—… ì–¸ì–´ ë° ì„¤ì • íŒŒì¼ í˜•ì‹ì— ëŒ€í•œ êµ¬ë¬¸ ê°•ì¡° ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. 
`Pygments`ëŠ” ì†ŒìŠ¤ ì½”ë“œë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ì•„ êµ¬ë¬¸ ê°•ì¡°ê°€ ì ìš©ëœ HTML, LaTeX ë˜ëŠ” í„°ë¯¸ë„ ì¶œë ¥ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤. 

ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼ê³¼ í…Œë§ˆë¥¼ ì§€ì›í•˜ì—¬ ê°•ì¡° í‘œì‹œëœ ì½”ë“œì˜ ëª¨ì–‘ì„ ì‚¬ìš©ì ì •ì˜í•  ìˆ˜ ìˆë‹¤. 

`Pygments`ëŠ” í…ìŠ¤íŠ¸ í¸ì§‘ê¸°, ë¬¸ì„œ ì‹œìŠ¤í…œ ë° ì½”ë“œ í”„ë¦¬ì  í„° ë“±ì—ì„œ ì½”ë“œ ìŠ¤ë‹ˆí«ì˜ ê°€ë…ì„±ê³¼ ì‹œê°ì ì¸ ë§¤ë ¥ì„ ë†’ì´ê¸° ìœ„í•´ ë„ë¦¬ ì‚¬ìš©ëœë‹¤.

ë‹¤ìŒì€ `Pygments`ë¥¼ ì‚¬ìš©í•˜ì—¬ Python ì½”ë“œë¥¼ ê°•ì¡° í‘œì‹œí•˜ëŠ” ì˜ˆì œë‹¤:


```python
from pygments import highlight
from pygments.lexers import PythonLexer
from pygments.formatters import TerminalFormatter

code = '''
def greet(name):
    print("Hello, " + name + "!")

greet("World")
'''

highlighted_code = highlight(code, PythonLexer(), TerminalFormatter())
print(highlighted_code)

```

Result 
```python
[34mdef[39;49;00m [
```


https://pygments.org/
https://pygments.org/docs/lexers/#pygments.lexers.sql.SqliteConsoleLexer

![](https://i.imgur.com/m8sQRR9.png)


```python
from drf_spectacular.utils import extend_schema
from rest_framework.decorators import action
from rest_framework import viewsets
from rest_framework.response import Response
from django.db import connection
from .models import Brand, Category, Product
from .serializers import BrandSerializer, CategorySerializer, ProductSerializer
from pygments import highlight
from pygments.formatters import TerminalFormatter
from pygments.lexers import SqlLexer
from sqlparse import format

# Create your views here.

class ProductViewSet(viewsets.ViewSet):
Â  Â  '''
Â  Â  A simple Viewset for viewing all products

Â  Â  '''
Â  Â  queryset = Product.objects.all()
Â  Â  lookup_field = "slug"

Â  Â  def retrieve(self, request, slug=None):
Â  Â  Â  Â  serializer = ProductSerializer(self.queryset.filter(slug=slug), many=True)
Â  Â  Â  Â  x = self.queryset.filter(slug=slug)
Â  Â  Â  Â  sqlformatted = format(str(x.query), reindent=True)
Â  Â  Â  Â  print(highlight(sqlformatted, SqlLexer(), TerminalFormatter()))
Â  Â  Â  Â  return Response(serializer.data)


...
```
![](https://i.imgur.com/0c9Hz2X.png)


![](https://i.imgur.com/Zb5cWyL.png)

í˜„ì¬ ì—¬ê¸°ì„œ ì¿¼ë¦¬ë¬¸ì€ 6ê°œê°€ ì‹¤í–‰ëœë‹¤.

```python
def retrieve(self, request, slug=None):
	serializer = ProductSerializer(self.queryset.filter(slug=slug), many=True)
	data = Response(serializer.data)
	queries = list(connection.queries)
	print(len(queries))
	
	return data
```

![](https://i.imgur.com/QuTmSFR.png)

```python
def retrieve(self, request, slug=None):
	serializer = ProductSerializer(self.queryset.filter(slug=slug), many=True)
	data = Response(serializer.data)
	queries = list(connection.queries)

	for query in queries:
		sqlformatted = format(str(query["sql"]), reindent=True)
		print(highlight(sqlformatted, SqlLexer(), TerminalFormatter()))
	return data
```

![](https://i.imgur.com/f3oKtU1.png)

ì´ëŸ° ì‹ìœ¼ë¡œ ì¿¼ë¦¬ë¬¸ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.    

í˜„ì¬ ì¿¼ë¦¬ê°€ 6ê°œê°€ ì‹¤í–‰ë˜ëŠ”ë° ì¿¼ë¦¬ë¬¸ì€ ì ìœ¼ë©´ ì ì„ ìˆ˜ë¡ ì„±ëŠ¥ì— ì¢‹ë‹¤.    
### select_related()

![](https://i.imgur.com/jEXpHST.png)

[select_related() ì°¸ê³ ](https://docs.djangoproject.com/en/4.2/ref/models/querysets/)

![](https://i.imgur.com/5AAnK28.png)

ì•„ë˜ì™€ ê°™ì´ ì¿¼ë¦¬ëŠ” 3ê°œë¡œ ì¤„ì—ˆê³  LEFT OUTER JOIN ìœ¼ë¡œ ì¿¼ë¦¬ë¬¸ì´ ë“¤ì–´ê°„ë‹¤.

![](https://i.imgur.com/N0kw0Aw.png)


![](https://i.imgur.com/xs1JKMr.png)

![](https://i.imgur.com/Zgps4Rh.png)

ì¿¼ë¦¬ëŠ” 2ê°œê°€ ì‹¤í–‰ë˜ì§€ë§Œ selected_relatedëŠ” ì—­ì°¸ì¡°ëŠ” ì ìš©ì´ ì•ˆëœë‹¤ê³  í•œë‹¤.    
í•˜ì§€ë§Œ Django ì—ì„œëŠ” ë‹¤ì–‘í•œ ì¿¼ë¦¬ì…‹ ë©”ì„œë“œê°€ ì œê³µë˜ë©° ê·¸ ì¤‘ í•˜ë‚˜ê°€ prefetch_related ë‹¤.     

prefetch_related ëŠ” ë‹¤ëŒ€ë‹¤ ê´€ê³„ë‚˜ ì—­ì°¸ì¡°ì™€ ê°™ì€ ë‹¤ëŒ€ë‹¤ ê´€ê³„ì—ì„œë„ ì‘ë™í•œë‹¤.
[prefetch_related ì°¸ê³ ](https://docs.djangoproject.com/en/4.2/ref/models/querysets/)
![](https://i.imgur.com/1Im8L3M.png)

## Build : Creating Custom Managers and QuerySet Methods

models.py
```python 
class ActiveManager(models.Manager):
Â  Â  def get_queryset(self):
Â  Â  Â  Â  return super().get_queryset.filter(is_active=True)

class Product(models.Model):
Â  Â  name = models.CharField(max_length=100)
Â  Â  slug = models.SlugField(max_length=255)
Â  Â  description = models.TextField(blank=True)
Â  Â  is_digital = models.BooleanField(default=False)
Â  Â  brand = models.ForeignKey(Brand, on_delete=models.CASCADE)
Â  Â  category = TreeForeignKey("Category", on_delete=models.SET_NULL, null=True, blank=True)
Â  Â  is_active = models.BooleanField(default=False)

Â  Â  # default manager
Â  Â  object = models.Manager()

Â  Â  # custom manager
Â  Â  isactive = ActiveManager()

Â  Â  def __str__(self):
Â  Â  Â  Â  return self.name
```

views.py
![](https://i.imgur.com/9mIcNhp.png)

ëª¨ë¸ì—ì„œ ì»¤ìŠ¤í…€í•œ ë©”ë‹ˆì € ë³€ìˆ˜ isactiveë¥¼ view ì—ì„œ objectë¥¼ isactiveë¡œ ê°ˆì•„ ê»´ì¤€ë‹¤.

ì´ ë•Œ ëª¨ë¸ì— ì„¤ì •í•´ ë†“ì€ activeë¥¼ ë¹„í™œì„±í™” í•˜ê²Œ ë˜ë©´ ì–´ë“œë¯¼ í˜ì´ì§€ì—ì„œ ì‚¬ë¼ì§€ê²Œ ëœë‹¤.    
ë”°ë¼ì„œ default ë§¤ë‹ˆì €ë„ í•¨ê»˜ ì„ ì–¸ í•´ì¤˜ì•¼ ë¹„í™œì„±í™”ëœ ë°ì´í„°ë„ í•¨ê»˜ ë³´ëŠ”ê²Œ ê°€ëŠ¥í•˜ë‹¤.

![](https://i.imgur.com/PjSnMZk.png)

### ë‹¤ë¥¸ ì ‘ê·¼ ë°©ë²•

models.py
```python
class ActiveManager(models.Manager):
Â  Â  # def get_queryset(self):
Â  Â  # Â  Â  return super().get_queryset().filter(is_active=True)
Â  Â  def isactive(self):
Â  Â  Â  Â  return self.get_queryset().filter(is_active=True)

class Product(models.Model):
Â  Â  name = models.CharField(max_length=100)
Â  Â  slug = models.SlugField(max_length=255)
Â  Â  description = models.TextField(blank=True)
Â  Â  is_digital = models.BooleanField(default=False)
Â  Â  brand = models.ForeignKey(Brand, on_delete=models.CASCADE)
Â  Â  category = TreeForeignKey("Category", on_delete=models.SET_NULL, null=True, blank=True)
Â  Â  is_active = models.BooleanField(default=False)

Â  Â  # # default manager
Â  Â  # object = models.Manager()
Â  Â  # # custom manager
Â  Â  # isactive = ActiveManager()

Â  Â  objects = ActiveManager()

Â  Â  def __str__(self):

Â  Â  Â  Â  return self.name
```


![](https://i.imgur.com/lcd3nkT.png)

ì´ëŸ° ì‹ìœ¼ë¡œ ì˜¤ë²„ë¼ì´ë”© ì—†ì´ë„ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

### ê·¸ëŸ¼ models.Manager ì™€ models.QuerySet ì€ ë­ê°€ ë‹¤ë¥´ì§€?
`models.Manager`ì™€ `models.QuerySet`ì€ Django ORMì˜ ì¼ë¶€ë¡œ, ë°ì´í„°ë² ì´ìŠ¤ì™€ ìƒí˜¸ì‘ìš©í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

**`models.Manager`:**

- `models.Manager`ëŠ” Django ëª¨ë¸ í´ë˜ìŠ¤ì˜ ê¸°ë³¸ ë§¤ë‹ˆì €ì…ë‹ˆë‹¤. ëª¨ë¸ í´ë˜ìŠ¤ì—ëŠ” ê¸°ë³¸ ë§¤ë‹ˆì €ê°€ í•­ìƒ ìˆìœ¼ë©°, `objects`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- `models.Manager`ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
- ëª¨ë¸ í´ë˜ìŠ¤ì˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒ, ìƒì„±, ìˆ˜ì • ë° ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ê°ì²´ë¥¼ ê²€ìƒ‰í•˜ëŠ” `all()` ë©”ì„œë“œì™€ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
- ì‚¬ìš©ì ì •ì˜ ë§¤ë‹ˆì €ë¥¼ ì¶”ê°€í•˜ì—¬ ì¶”ê°€ì ì¸ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ë‚˜ íŠ¹ì • ì¡°ê±´ì˜ ê°ì²´ë¥¼ ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì¥ì : ëª¨ë¸ í´ë˜ìŠ¤ì™€ ë°€ì ‘í•˜ê²Œ ì—°ê²°ë˜ì–´ ê°ì²´ì˜ ìƒì„±ê³¼ ê´€ë ¨ëœ ë©”ì„œë“œë¥¼ í†µí•©ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë‹¨ì : íŠ¹ì • ì¡°ê±´ì— ë§ëŠ” ë°ì´í„° ì¡°íšŒì— ì œì•½ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**`models.QuerySet`:**

- `models.QuerySet`ì€ ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ì¡°íšŒëœ ê°ì²´ì˜ ì§‘í•©ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, ì¡°íšŒëœ ê°ì²´ë“¤ì„ ë‹¤ë£¨ëŠ” ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.
- `models.Manager`ë¥¼ í†µí•´ ì ‘ê·¼ ê°€ëŠ¥í•˜ë©°, ë§ì€ ìœ ìš©í•œ ë©”ì„œë“œë“¤ì„ ì œê³µí•˜ì—¬ ë°ì´í„°ë¥¼ í•„í„°ë§, ì •ë ¬, ì œí•œí•˜ê³  ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë©”ì„œë“œ ì²´ì´ë‹ì„ í†µí•´ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- `models.QuerySet`ì€ ì§€ì—° ì‹¤í–‰ë˜ëŠ” íŠ¹ì„±ì„ ê°€ì§€ë©°, ì‹¤ì œë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ê¹Œì§€ëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ì¥ì : ë°ì´í„°ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì¡°ì‘í•˜ê³  í•„í„°ë§í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì§€ì—° ì‹¤í–‰ì„ í†µí•´ ì„±ëŠ¥ì„ ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë‹¨ì : ëª¨ë¸ í´ë˜ìŠ¤ì™€ ë¶„ë¦¬ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ê°ì²´ì˜ ìƒì„±ê³¼ ê´€ë ¨ëœ ë©”ì„œë“œëŠ” `models.Manager`ë¥¼ í†µí•´ ì œê³µë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ìš”ì•½í•˜ìë©´, `models.Manager`ëŠ” ëª¨ë¸ í´ë˜ìŠ¤ì™€ ë°€ì ‘í•œ ê´€ë ¨ì´ ìˆìœ¼ë©° ê°ì²´ì˜ ìƒì„±ê³¼ ê´€ë ¨ëœ ë©”ì„œë“œë¥¼ ì œê³µí•˜ëŠ” ë°˜ë©´, `models.QuerySet`ì€ ë°ì´í„° ì¡°íšŒì™€ ì¡°ì‘ì— íŠ¹í™”ëœ ë©”ì„œë“œë¥¼ ì œê³µí•˜ì—¬ ìœ ì—°í•œ ë°ì´í„° ì²˜ë¦¬ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ë‘ í´ë˜ìŠ¤ëŠ” í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” Django ORMì˜ í•µì‹¬ ìš”ì†Œì…ë‹ˆë‹¤.

## Build : Custom Field Ordered List

### order number ë§Œë“¤ê¸°

![](https://i.imgur.com/eoprcmH.png)


![](https://i.imgur.com/cFeOnVm.png)

[ëª¨ë¸ í•„ë“œ django](https://docs.djangoproject.com/en/4.2/ref/models/fields/)

![](https://i.imgur.com/sD3K0Za.png)
ì˜¤ë” ë„˜ë²„ê°€ ë§ˆì´ë„ˆìŠ¤ë„ í‘œì‹œ ë˜ëŠ” ê²ƒ ë³´ë‹¤ëŠ” ì–‘ìˆ˜ë¡œ í‘œì‹œë˜ë‹ˆ PositiveIntegerField() ë¡œ ì‚¬ìš©í•˜ëŠ”ê²Œ ë‚«ë‹¤.     

![](https://i.imgur.com/4S4nAh5.png)

### ì»¤ìŠ¤í…€ í•„ë“œ ë§Œë“¤ê¸°

ìœ„ì™€ ê°™ì´ ë§Œë“¤ì–´ ë³´ë©´ ê° ì œí’ˆë§ˆë‹¤ ë„˜ë²„ê°€ ë‹¤ë¥´ê²Œ ë“¤ì–´ê°€ì„œ í¸í•˜ê¸´ í•œë°
ìœ ì € ì…ì¥ì—ì„œ ë“œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ê¸°ë„ ê·¸ë ‡ê³  ìˆ˜ë™ìœ¼ë¡œ ì„ íƒí•˜ëŠ” ë“± ë¶ˆí¸í•œ ì ì´ ë§ë‹¤.      

![](https://i.imgur.com/47zmW8X.png)

![](https://i.imgur.com/2bEiEFD.png)

```python
from django.db import models
from django.core import checks

class OrderField(models.PositiveIntegerField):

Â  Â  description = "Ordering field on a unique field"

Â  Â  def __init__(self, unique_for_field=None, *args, **kwargs):
Â  Â  Â  Â  self.unique_for_field = unique_for_field
Â  Â  Â  Â  super().__init__(*args, **kwargs)

Â  Â  def check(self, **kwargs):
Â  Â  Â  Â  return [
Â  Â  Â  Â  Â  Â  *super().check(**kwargs),
Â  Â  Â  Â  Â  Â  *self._check_for_field_attribute(**kwargs)
Â  Â  Â  Â  ]

Â  Â  def _check_for_field_attribute(self, **kwargs):
Â  Â  Â  Â  if self.unique_for_field is None:
Â  Â  Â  Â  Â  Â  return [checks.Error("OrderField must define")]
```

ìš°ì„  OrderFieldëŠ” models.PositiveIntegerField ë¥¼ ìƒì†í•´ì„œ êµ¬í˜„í–ˆê³  ì–‘ìˆ˜ ê°’ìœ¼ë¡œ ì €ì¥í•˜ëŠ” í•„ë“œë¡œì„œ ëª¨ë¸ ë‚´ì—ì„œ ìˆœì„œë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•œ ì •ìˆ˜ ê°’ì„ ì €ì¥í•˜ëŠ” ì—­í• ì„ í•œë‹¤.     

`OrderField` í´ë˜ìŠ¤ëŠ” ì¶”ê°€ì ìœ¼ë¡œ `unique_for_field` ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. `unique_for_field`ëŠ” í•´ë‹¹ í•„ë“œê°€ ê³ ìœ í•´ì•¼ í•˜ëŠ” ë‹¤ë¥¸ í•„ë“œì˜ ì´ë¦„ì„ ë‚˜íƒ€ë‚¸ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `unique_for_field='category'`ë¼ê³  ì„¤ì •í•˜ë©´, ë™ì¼í•œ `category` í•„ë“œ ê°’ì„ ê°–ëŠ” ê°ì²´ë“¤ ê°„ì—ë§Œ `OrderField` ê°’ì´ ê³ ìœ í•´ì•¼ í•œë‹¤.      

`check` ë©”ì„œë“œëŠ” Djangoì˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì˜¤ë²„ë¼ì´ë“œë˜ì—ˆë‹¤. ì´ ë©”ì„œë“œëŠ” í•„ë“œê°€ ëª¨ë¸ì—ì„œ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤. `super().check(**kwargs)`ë¥¼ í†µí•´ ìƒìœ„ í´ë˜ìŠ¤ì˜ `check` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œ í›„, `_check_for_field_attribute` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ `unique_for_field` ë§¤ê°œë³€ìˆ˜ì˜ ìœ íš¨ì„±ì„ í™•ì¸í•œë‹¤.     

`_check_for_field_attribute` ë©”ì„œë“œëŠ” `unique_for_field`ì˜ ê°’ì„ í™•ì¸í•˜ì—¬ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œë‹¤. ìœ„ì˜ ì½”ë“œì—ì„œëŠ” `self.unique_for_field in None`ì´ë¼ëŠ” ë¹„êµë¥¼ ìˆ˜í–‰í•˜ê³  ìˆë‹¤. í•˜ì§€ë§Œ ì˜¬ë°”ë¥¸ ë¹„êµëŠ” `self.unique_for_field is None` ê°€ ë˜ì–´ì•¼ í•œë‹¤. `unique_for_field` ê°’ì´ `None`ì¸ ê²½ìš°ì—ëŠ” `checks.Error()`ë¥¼ ë°˜í™˜í•˜ì—¬ ìœ íš¨ì„± ê²€ì‚¬ì—ì„œ ì˜¤ë¥˜ë¥¼ í‘œì‹œí•œë‹¤.       

### ëª¨ë¸ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬

fields.py
![](https://i.imgur.com/spI59yQ.png)
orderì˜ ê°ì²´ëŠ” í˜„ì¬ productë¥¼ ê°€ë¦¬í‚¤ê³  ìˆë‹¤.

models.py
![](https://i.imgur.com/Ib49b3S.png)

elif ë¬¸ì—ì„œ ëª¨ë¸ì— ìˆëŠ” ëª¨ë“  í•„ë“œë¥¼ ë¦¬ìŠ½ë¡œ ë¶ˆëŸ¬ì˜¨ í›„ "product" ë€ì— ì‹¤ì œ í•„ë“œê°€ ë§Œì•½ì— ì—†ë‹¤ë©´ ìœ„ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë‚˜ì˜¤ê²Œ ë§Œë“ ë‹¤.    
ë‹¤ì‹œ ë§í•˜ìë©´ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ í•  ë•Œ í•„ë“œì— ì—†ëŠ” ë‚´ìš©ì„ order í•„ë“œì— "product" í˜¹ì€ ProductLine ì— ìˆëŠ” ë‚´ìš©ì´ ì•„ë‹Œ, ì˜ˆë¥¼ ë“¤ì–´ "asasdasd"  ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì—ëŸ¬ê°€ ë‚˜ì˜¨ë‹¤.      

## ìë™ìœ¼ë¡œ ì˜¤ë”ë„˜ë²„ ë§Œë“¤ê¸°

![](https://i.imgur.com/64ckTOD.png)

![](https://i.imgur.com/MNXDlk8.png)
Django ëª¨ë¸ì˜ pre_save ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•´ì„œ ì‚¬ìš©ì ì •ì˜ ë™ì‘ì„ ì¶”ê°€í•œë‹¤.      
pre_save ë©”ì„œë“œëŠ” ëª¨ë¸ ê°ì²´ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ê¸° ì „ì— ì‹¤í–‰ë˜ëŠ” ë‹¨ê³„ì—ì„œ í˜¸ì¶œëœë‹¤.     

model_instance ëŠ” í˜„ì¬ ì €ì¥ë˜ëŠ” ëª¨ë¸ ê°ì²´ì˜ ì¸ìŠ¤í„´ìŠ¤ë‹¤.    
add ëŠ” ë ˆì½”ë“œê°€ ì¶”ê°€ ë˜ì—ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë¶ˆë¦¬ì–¸ ê°’ì´ë‹¤.    

ìœ„ ì½”ë“œì—ì„œ pre_save ë©”ì„œë“œê°€ í˜¸ì¶œë˜ë©´ model_instance ê°ì²´ì˜ self.attname ì†ì„± ê°’ì„ í™•ì¸í•œë‹¤. ì´ ì†ì„±ì€ OrderField í•„ë“œì˜ ì´ë¦„ì„ ë‚˜íƒ€ë‚¸ë‹¤.     
ë§Œì•½ self.attname ì†ì„ì˜ ê°’ì´ None ì´ë©´ í•´ë‹¹ í•„ë“œì— ê°’ì´ ì €ì¥ë˜ì§€ ì•Šì€ ê²½ìš°ì´ë¯€ë¡œ ì´ëŸ´ ë•ŒëŠ” self.model.objects.all() ì„ ì‚¬ìš©í•´ì„œ í•´ë‹¹ ëª¨ë¸ì˜ ëª¨ë“  ê°ì²´ë¥¼ ì¡°íšŒí•œë‹¤.     

ê·¸ í›„ query ë”•ì…”ë„ˆë¦¬ë¥¼ ìƒì„±í•˜ê³  self.unique_for_field ê°’ì„ í•„ë“œì˜ ì‹¤ì œ ê°’ìœ¼ë¡œ ì„¤ì •í•´ì„œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•œë‹¤.    

ì˜ˆë¥¼ ë“¤ì–´, `self.unique_for_field`ê°€ `'product'`ì´ê³  ëª¨ë¸ ê°ì²´ì˜ `product` í•„ë“œ ê°’ì´ `<Product: p1>`ì¸ ê²½ìš° `query`ëŠ” `{'product': <Product: p1>}`ê³¼ ê°™ì´ ìƒì„±ëœë‹¤.

ê·¸ í›„, `query_set.filter(**query)`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìœ„ì—ì„œ ìƒì„±í•œ ì¿¼ë¦¬ë¥¼ ì´ìš©í•´ í•„í„°ë§ëœ ì¿¼ë¦¬ì…‹ì„ ì–»ëŠ”ë‹¤. ì´ ì¿¼ë¦¬ì…‹ì€ `unique_for_field` í•„ë“œì˜ ê°’ì´ `model_instance`ì˜ í•´ë‹¹ í•„ë“œ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ëª¨ë“  ê°ì²´ë¥¼ í¬í•¨í•˜ê²Œ ëœë‹¤.      

ë§Œì•½ `ObjectDoesNotExist` ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤ë©´, ì¦‰, ìœ„ì˜ í•„í„°ë§ëœ ì¿¼ë¦¬ì…‹ì´ ë¹„ì–´ìˆëŠ” ê²½ìš°ì—ëŠ” `value`ë¥¼ 1ë¡œ ì„¤ì •í•œë‹¤.     

ìœ„ì˜ ì½”ë“œì—ì„œ `value`ëŠ” ìµœì¢…ì ìœ¼ë¡œ `pre_save` ë©”ì„œë“œì—ì„œ ë°˜í™˜ë˜ëŠ” ê°’ì´ë‹¤. ì´ ê°’ì€ ëª¨ë¸ ê°ì²´ì˜ `self.attname` í•„ë“œ ê°’ì´ `None`ì¸ ê²½ìš°ì— ì‚¬ìš©ë˜ë©°, í•„í„°ë§ëœ ì¿¼ë¦¬ì…‹ì´ ë¹„ì–´ìˆì„ ê²½ìš°ì—ëŠ” 1ë¡œ ì„¤ì •ëœë‹¤.     

ë§ˆì§€ë§‰ìœ¼ë¡œ, ë§Œì•½ `self.attname` í•„ë“œ ê°’ì´ `None`ì´ ì•„ë‹Œ ê²½ìš°, ì¦‰, í•„ë“œì— ê°’ì´ ì´ë¯¸ ì§€ì •ë˜ì–´ ìˆëŠ” ê²½ìš°ì—ëŠ” `super().pre_save(model_instance, add)`ì„ í˜¸ì¶œí•˜ì—¬ ì›ë˜ì˜ `pre_save` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤.      

### ì˜¤ë”ë„˜ë²„ ì¤‘ë³µ ì—†ì• ê¸° 

[ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ ë ˆí¼ëŸ°ìŠ¤](https://docs.djangoproject.com/en/4.2/ref/models/instances/)

![](https://i.imgur.com/FbDEeF4.png)


![](https://i.imgur.com/D5wbgaz.png)
- `latest(field_name=None)` ë©”ì„œë“œ: `latest()` ë©”ì„œë“œëŠ” ì¿¼ë¦¬ì…‹ì„ í†µí•´ íŠ¹ì • í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìµœì‹  ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œë‹¤. `field_name` ë§¤ê°œë³€ìˆ˜ë¥¼ í†µí•´ ìµœì‹  ê°ì²´ë¥¼ íŒë³„í•  í•„ë“œë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œëŠ” ëª¨ë¸ì˜ `Meta` í´ë˜ìŠ¤ì—ì„œ `get_latest_by` ì†ì„±ì´ ì„¤ì •ëœ í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìµœì‹  ê°ì²´ë¥¼ ê°€ì ¸ì˜¨ë‹¤. `latest()` ë©”ì„œë“œëŠ” ì¿¼ë¦¬ì…‹ì„ ì •ë ¬í•˜ì—¬ ê°€ì¥ ìµœê·¼ì— ìƒì„±ëœ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. ë§Œì•½ í•´ë‹¹ í•„ë“œë¥¼ ê°€ì§„ ê°ì²´ê°€ ì—†ì„ ê²½ìš° `ObjectDoesNotExist` ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.      
    
- `attname`: `attname`ì€ Djangoì˜ í•„ë“œ ì†ì„± ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ê° í•„ë“œëŠ” ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì— ì €ì¥ë˜ëŠ” ê°’ì˜ ì»¬ëŸ¼ ì´ë¦„ì„ ê°€ì§€ê³  ìˆë‹¤. `attname`ì€ í•„ë“œì˜ ì»¬ëŸ¼ ì´ë¦„ì„ ë‚˜íƒ€ë‚´ëŠ” ì†ì„±ì´ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ í•„ë“œì˜ ì´ë¦„ê³¼ ë™ì¼í•˜ì§€ë§Œ, í•„ë“œ íƒ€ì…ì— ë”°ë¼ ë³€í™˜ë˜ëŠ” ê²½ìš°ê°€ ìˆì„ ìˆ˜ ìˆë‹¤.     
    

ìœ„ì˜ ì½”ë“œì—ì„œ `latest()` ë©”ì„œë“œëŠ” `qs` ì¿¼ë¦¬ì…‹ì—ì„œ `attname`ì„ ê¸°ì¤€ìœ¼ë¡œ ê°€ì¥ ìµœê·¼ ê°ì²´ë¥¼ ê°€ì ¸ì˜¨ë‹¤. `attname`ì€ `OrderField` í•„ë“œì˜ ì»¬ëŸ¼ ì´ë¦„ì„ ê°€ë¦¬í‚¤ë©°, `last_item`ì—ëŠ” ê°€ì¥ ìµœê·¼ `OrderField` ê°’ì„ ê°€ì§„ ê°ì²´ê°€ ì €ì¥ëœë‹¤. ì´í›„ `value` ë³€ìˆ˜ëŠ” `last_item.order + 1`ì„ í• ë‹¹í•˜ì—¬ ìƒˆë¡œìš´ `OrderField` ê°’ì„ ìƒì„±í•œë‹¤. ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ `OrderField` ê°’ì´ ìë™ìœ¼ë¡œ ì¦ê°€í•˜ë„ë¡ êµ¬í˜„ëœë‹¤.     

ë§ˆì§€ë§‰ìœ¼ë¡œ, `else` ë¸”ë¡ì€ `model_instance` ê°ì²´ì— `attname` í•„ë“œê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš° `super().pre_save(model_instance, add)`ë¥¼ í˜¸ì¶œí•˜ì—¬ ê¸°ë³¸ `pre_save()` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•œë‹¤.     

ì¦‰, ìœ„ì˜ ì½”ë“œëŠ” `pre_save()` ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ `OrderField`ì˜ ê°’ì´ ì—†ëŠ” ê²½ìš° ì´ì „ `OrderField` ê°’ ì¤‘ ê°€ì¥ ìµœê·¼ ê°’ì„ ê°€ì ¸ì™€ 1ì„ ì¦ê°€ì‹œì¼œ ìƒˆë¡œìš´ `OrderField` ê°’ì„ ìƒì„±í•˜ê³ , ê°’ì´ ì´ë¯¸ ìˆëŠ” ê²½ìš° ê¸°ë³¸ `pre_save()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì›ë˜ ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ë¡œì§ì´ë‹¤.     
  
í•˜ì§€ë§Œ í”„ë¡œë•íŠ¸ ë¼ì¸ì„ 2ê°œ ë§Œë“  í›„ ë‘˜ ë‹¤ ì˜¤ë” ë„˜ë²„ë¥¼ ê° ê° 1, 1 ë¡œ í•´ë„ ì ìš©ëœë‹¤.      
ì˜¤ë” ë„˜ë²„ëŠ” pk ì²˜ëŸ¼ ìœ ë‹ˆí¬ ê°’ì´ ë˜ì•¼ ë˜ë¯€ë¡œ ì¤‘ë³µì„ ë°©ì§€í•´ì¤˜ì•¼ í•œë‹¤.     

![](https://i.imgur.com/VtXb8QF.png)
`def clean_fields(self, exclude=None):`ëŠ” Django ëª¨ë¸ì˜ ë©”ì„œë“œ ì¤‘ í•˜ë‚˜ì¸ `clean_fields()`ë¥¼ ì˜¤ë²„ë¼ì´ë“œí–ˆë‹¤. ì´ ë©”ì„œë“œëŠ” ëª¨ë¸ì˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.     

`clean_fields()` ë©”ì„œë“œëŠ” `ModelForm`ì˜ ìœ íš¨ì„± ê²€ì‚¬ì—ì„œ í˜¸ì¶œë˜ë©°, ê° í•„ë“œì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•˜ê¸° ì „ì— ì‹¤í–‰ëœë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ `clean_fields()` ë©”ì„œë“œëŠ” `super().clean_fields(exclude=exclude)`ë¥¼ í˜¸ì¶œí•˜ì—¬ ë¶€ëª¨ í´ë˜ìŠ¤ì˜ `clean_fields()` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê³  í•„ë“œ ìœ íš¨ì„±ì„ ê²€ì‚¬í•œë‹¤.     

ìœ„ì˜ ì½”ë“œì—ì„œ `clean_fields()` ë©”ì„œë“œëŠ” ë¶€ëª¨ í´ë˜ìŠ¤ì¸ `super().clean_fields(exclude=exclude)`ë¥¼ í˜¸ì¶œí•˜ì—¬ í•„ë“œì˜ ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œ í›„ ì¶”ê°€ì ì¸ ê²€ì¦ì„ ì§„í–‰í•œë‹¤.     

`query_set`ì€ `ProductLine` ëª¨ë¸ì—ì„œ í˜„ì¬ ê°ì²´ì˜ `product` í•„ë“œì™€ ë™ì¼í•œ ê°’ì„ ê°€ì§€ëŠ” ëª¨ë“  `ProductLine` ê°ì²´ì˜ ì¿¼ë¦¬ì…‹ì„ ê°€ì ¸ì˜¨ë‹¤. ì´í›„ ë°˜ë³µë¬¸ì„ í†µí•´ ì¿¼ë¦¬ì…‹ ë‚´ì˜ ê°ì²´ë“¤ê³¼ í˜„ì¬ ê°ì²´ë¥¼ ë¹„êµí•˜ê³ , ë‹¤ë¥¸ ê°ì²´ì˜ `id`ê°€ í˜„ì¬ ê°ì²´ì˜ `id`ì™€ ë‹¤ë¥´ê³  `order` í•„ë“œ ê°’ì´ ì¤‘ë³µëœ ê²½ìš° `ValidationError`ì„ ë°œìƒì‹œí‚¨ë‹¤. ì´ëŠ” ì¤‘ë³µëœ `order` ê°’ì„ ê°€ì§€ëŠ” ê°ì²´ê°€ ì¡´ì¬í•  ê²½ìš° ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ë¡œ ì²˜ë¦¬ëœë‹¤.       

ë”°ë¼ì„œ, `clean_fields()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ `ProductLine` ëª¨ë¸ì˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆí•˜ê³  ì¤‘ë³µëœ `order` ê°’ì„ ê°€ì§€ëŠ” ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.       

self ëŠ” í˜„ì¬ ProductLine ê°ì²´ë¥¼ ë‚˜íƒ€ë‚´ê³  í•´ë‹¹ ë©”ì„œë“œê°€ ì†í•œ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤.     
ì´ë¥¼ í™œìš©í•´ self ëŠ” ProductLine ê°ì²´ì˜ ì†ì„± ë° ë©”ì„œë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.      

query_set ë³€ìˆ˜ëŠ” ProductLine ëª¨ë¸ì˜ product í•„ë“œê°€ í˜„ì¬ self.productì™€ ë™ì¼í•œ ê°’ì„ ê°€ì§€ëŠ” ëª¨ë“  ProductLine ê°ì²´ë¥¼ ì¡°íšŒí•œ ì¿¼ë¦¬ ì…‹ì„ ìƒì„±í•˜ê³  query_set ë³€ìˆ˜ëŠ” í•´ë‹¹ ì¿¼ë¦¬ì…‹ì„ í• ë‹¹ ë°›ì•„ ì‚¬ìš©í•œë‹¤.      

for object in query_set ì€ query_set ë‚´ì˜ ê° ProductLine ê°ì²´ë¥¼ ìˆœíšŒí•˜ë©´ì„œ objectëŠ” query_setì— ìˆëŠ” ê° ProductLine ê°ì²´ë¥¼ ì°¨ë¡€ëŒ€ë¡œ ê°€ë¦¬í‚¨ë‹¤.     

ì¦‰, `self`ëŠ” í˜„ì¬ `ProductLine` ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ê³ , `query_set`ê³¼ `object`ëŠ” `ProductLine` ëª¨ë¸ì—ì„œ í•´ë‹¹ í•„ë“œ ê°’ê³¼ ê´€ë ¨ëœ ë‹¤ë¥¸ ê°ì²´ë“¤ì„ ì¡°íšŒí•˜ê³ , ìˆœíšŒí•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë³€ìˆ˜ë“¤ì´ë‹¤.     


## Testing : Pytest Adopts and Common Commands

```python
pytest --cov
```

![](https://i.imgur.com/TIHGONa.png)

í˜„ì¬ field.pyì—ì„œ missê°€ 17ê°œ models.py ì—ì„œ 6ê°œ, views.py ì—ì„œ 10ê°œê°€ ë‚˜ì˜¨ë‹¤.     

--covë¥¼ í„°ë¯¸ë„ì—ì„œ ìë™ìœ¼ë¡œ ë™ì‘í•˜ê²Œ í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •ì„ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤.     

pytest.ini
```python
[pytest]

DJANGO_SETTINGS_MODULE = drfecommerce.settings.local

python_files = test_*.py

addopts = --cov
```

ë˜í•œ pytest.ini ê°€ ì•„ë‹Œ setup.cfg ë¡œ ì„¤ì •í•˜ê³ 
`[tool:pytest]` ë¡œ ë³€ê²½í•˜ë©´ ì „ì²´ì ìœ¼ë¡œ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.     

1. `pytest.ini`:
    - `pytest` í”„ë ˆì„ì›Œí¬ì˜ êµ¬ì„±ì„ ì§€ì •í•˜ëŠ” íŒŒì¼ì´ë‹¤.
    - `pytest.ini` íŒŒì¼ì€ í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ìƒì„±ë˜ë©°, ëª¨ë“  í•˜ìœ„ ë””ë ‰í† ë¦¬ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.
    - ì£¼ë¡œ `pytest`ì˜ ì„¤ì • ì˜µì…˜, í”ŒëŸ¬ê·¸ì¸ êµ¬ì„±, í…ŒìŠ¤íŠ¸ ì„¸ì…˜ ê´€ë¦¬ ë“±ê³¼ ê´€ë ¨ëœ ì„¤ì •ì„ ì§€ì •í•œë‹¤.
    - `pytest.ini` íŒŒì¼ì€ `[pytest]` ì„¹ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì„¤ì • ì˜µì…˜ì„ ì§€ì •í•œë‹¤.
2. `setup.cfg`:
    - í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ, íŒ¨í‚¤ì§•, í…ŒìŠ¤íŠ¸ ë“±ì„ ê´€ë¦¬í•˜ëŠ” `setuptools`ì˜ ì„¤ì • íŒŒì¼ì´ë‹¤.
    - `setup.cfg` íŒŒì¼ì€ ì£¼ë¡œ í”„ë¡œì íŠ¸ì˜ ë©”íƒ€ë°ì´í„°, íŒ¨í‚¤ì§€ êµ¬ì„±, ì˜ì¡´ì„± ê´€ë¦¬, ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ ë“±ì„ ì§€ì •í•œë‹¤.
    - `setup.cfg` íŒŒì¼ì€ `[tool:pytest]` ì„¹ì…˜ì„ ì‚¬ìš©í•˜ì—¬ `pytest` ê´€ë ¨ ì„¤ì •ì„ ì§€ì •í•œë‹¤. ì´ ì„¹ì…˜ì„ ì‚¬ìš©í•˜ì—¬ `pytest` í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì— ëŒ€í•œ ì˜µì…˜, í™˜ê²½ ë³€ìˆ˜, í”ŒëŸ¬ê·¸ì¸ êµ¬ì„± ë“±ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
    - `setup.cfg`ëŠ” ë˜í•œ `setuptools`ì˜ ë‹¤ë¥¸ ê¸°ëŠ¥ë“¤ì„ ìœ„í•œ ë‹¤ì–‘í•œ ì„¹ì…˜ë“¤ì„ í¬í•¨í•  ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ, `pytest.ini`ëŠ” ì£¼ë¡œ `pytest` í”„ë ˆì„ì›Œí¬ ìì²´ì˜ êµ¬ì„±ì„ ì§€ì •í•˜ëŠ” ë° ì‚¬ìš©ë˜ê³ , `setup.cfg`ëŠ” í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ë° íŒ¨í‚¤ì§• ì„¤ì •ì—ì„œ `pytest` ê´€ë ¨ ì„¤ì •ì„ ì§€ì •í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.

ë³€ê²½ í›„ ì „ì²´ì ìœ¼ë¡œ ê²€ì‚¬ê°€ ì‹œí–‰ëœë‹¤.     
![](https://i.imgur.com/4UOv6Xq.png)

ë§Œì•½ ê°œë³„ í…ŒìŠ¤íŠ¸ë¥¼ ì›í•  ê²½ìš°ëŠ” ì´ë ‡ê²Œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.     
![](https://i.imgur.com/trjI6Xc.png)

test_category_get ë§Œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ê³  ì‹¶ë‹¤ë©´ í„°ë¯¸ë„ì— `pytest -k test_category_get`  ì´ëŸ° ì‹ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

![](https://i.imgur.com/kenmoM5.png)

ì¶”ê°€ë¡œ addpts = --cov -x ë¡œ ì„¤ì •í•˜ë©´ ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì§€ ì•Šê³  í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•œ ì‹œì ë¶€í„° ë©ˆì¶˜ë‹¤.          
í…ŒìŠ¤íŠ¸í• ê²Œ ë§ì„ ê²½ìš° ìœ ìš©í•˜ê²Œ ì“¸ ìˆ˜ ìˆë‹¤.      
ë˜í•œ pytest -s ë¥¼ ì‚¬ìš©í•˜ë©´ í…ŒìŠ¤íŠ¸ë•Œ ë””ë²„ê¹…ê²¸ print ë¬¸ë„ ì¶œë ¥ë˜ë‹ˆ ìƒí™©ì— ë§ê²Œ ì‚¬ìš©í•˜ë©´ ì¢‹ë‹¤.     


## Testing : Models

ìƒˆë¡­ê²Œ ë§Œë“  ëª¨ë¸ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ì „ì— coverage htmlì„ ì—…ë°ì´íŠ¸í•´ì£¼ê¸° ìœ„í•´ í„°ë¯¸ë„ì—ì„œ ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì¤€ë‹¤. 

```python
coverage html
```

![](https://i.imgur.com/fS6KL0s.png)

![](https://i.imgur.com/TPIAglH.png)


ì—¬ê¸°ì—ì„œ ëª¨ë¸ì„ í™•ì¸ í–ˆì„ ê²½ìš° í´ë¦­í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ìƒì„¸íˆ ì˜ ë‚˜ì˜¨ë‹¤.

![](https://i.imgur.com/7H9FwlY.png)

test_models.py

![](https://i.imgur.com/BKfOMaj.png)

factories.py
![](https://i.imgur.com/zI0msY1.png)
conftest.py
![](https://i.imgur.com/J3j3RjB.png)


í…ŒìŠ¤íŠ¸ ê²°ê³¼

![](https://i.imgur.com/C3jl0y4.png)

### 10%ì˜ ë¬¸ì œëŠ” ë¬´ì—‡ì¼ê¹Œ?

ìš°ì„  ì ìœ¼ë¡œ models.py ì˜ clean_fields ë¶€ë¶„ì„ clean ìœ¼ë¡œ ë³€ê²½í•´ì¤˜ì•¼ í•œë‹¤.
![](https://i.imgur.com/z6tNkgG.png)
1. clean_fields():
    - `clean_fields`ëŠ” Django ëª¨ë¸ì—ì„œ ê¸°ë³¸ ì œê³µë˜ëŠ” ë©”ì„œë“œë‹¤.
    - ì´ ë©”ì„œë“œëŠ” ê° í•„ë“œì˜ ìœ íš¨ì„±ì„ ë…ë¦½ì ìœ¼ë¡œ ê²€ì‚¬ë‹¤.
    - í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ëŠ” í•„ë“œì˜ `clean_<field_name>()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ìˆ˜í–‰ëœë‹¤.
    - `clean_fields`ëŠ” ë‹¨ì¼ í•„ë“œì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ì— ì‚¬ìš©ë˜ë©°, í•„ë“œ ê°„ì˜ ìƒí˜¸ì‘ìš©ì€ ì²˜ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ ì¤‘ì— ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ëŠ” í•´ë‹¹ í•„ë“œì— ëŒ€í•œ `ValidationError`ìœ¼ë¡œ ë°˜í™˜ëœë‹¤.
2. clean():
    - `clean`ì€ Django ëª¨ë¸ì—ì„œ ì œê³µí•˜ëŠ” ì¼ë°˜ì ì¸ ìœ íš¨ì„± ê²€ì‚¬ ë©”ì„œë“œë‹¤.
    - `clean`ì€ ì—¬ëŸ¬ í•„ë“œ ê°„ì˜ ìƒí˜¸ì‘ìš©ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
    - ì´ ë©”ì„œë“œëŠ” ëª¨ë“  í•„ë“œì˜ ìœ íš¨ì„±ì„ í•¨ê»˜ ê²€ì‚¬í•  ìˆ˜ ìˆìœ¼ë©°, í•„ìš”í•œ ê²½ìš° ì—¬ëŸ¬ í•„ë“œë¥¼ ë™ì‹œì— ì‚¬ìš©í•˜ì—¬ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
    - `clean` ë©”ì„œë“œëŠ” í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ ì´ì™¸ì—ë„ ë‹¤ë¥¸ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬, ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ì™€ì˜ ìƒí˜¸ì‘ìš©, ë°ì´í„° ë³€í™˜ ë“±ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
    - í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ ì¤‘ì— ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ëŠ” í•´ë‹¹ í•„ë“œì— ëŒ€í•œ `ValidationError`ìœ¼ë¡œ ë°˜í™˜ë˜ë©°, ì¼ë°˜ì ì¸ ì˜¤ë¥˜ëŠ” `ValidationError`ì„ í†µí•´ ì „ë‹¬ëœë‹¤.

ë”°ë¼ì„œ, `clean`ì€ ë³´ë‹¤ ìœ ì—°í•œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œì´ë©°, í•„ë“œ ê°„ì˜ ìƒí˜¸ì‘ìš©ì´ í•„ìš”í•œ ê²½ìš°ì— ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤. `clean_fields`ëŠ” ê° í•„ë“œì˜ ë…ë¦½ì ì¸ ìœ íš¨ì„± ê²€ì‚¬ì— ì‚¬ìš©ë˜ë©°, ê°„ë‹¨í•œ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ì— ì í•©í•˜ë‹¤.      

ê·¸ë¦¬ê³  test í´ë”ì— test_models.py ì— ProductLine ëª¨ë¸ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.     

![](https://i.imgur.com/oRZrtcL.png)
1. `test_str_method(self, product_line_factory)`
    - ì´ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œëŠ” `product_line_factory`ë¥¼ ì‚¬ìš©í•˜ì—¬ `ProductLine` ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , í•´ë‹¹ ê°ì²´ì˜ `__str__()` ë©”ì„œë“œê°€ ì˜ˆìƒí•œ ë¬¸ìì—´ì„ ë°˜í™˜í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
    - ì˜ˆìƒí•œ ë¬¸ìì—´ì€ "12345" ë‹¤.
    - `assert` ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ë°˜í™˜ëœ ë¬¸ìì—´ê³¼ ì˜ˆìƒí•œ ë¬¸ìì—´ì„ ë¹„êµí•œë‹¤.
2. `test_duplicate_order_values(self, product_line_factory, product_factory)`
    - ì´ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œëŠ” `product_factory`ì™€ `product_line_factory`ë¥¼ ì‚¬ìš©í•˜ì—¬ `Product`ì™€ `ProductLine` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
    - ì²« ë²ˆì§¸ `product_line_factory` í˜¸ì¶œë¡œ `order` ê°’ì´ 1ì¸ `ProductLine` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
    - ë‘ ë²ˆì§¸ `product_line_factory` í˜¸ì¶œì€ `order` ê°’ì´ 1ì´ê³  ë™ì¼í•œ `Product` ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ëŠ” `ProductLine` ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , `clean()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.
    - clean ë©”ì„œë“œëŠ” ProductLine ëª¨ë¸ì˜ ì¤‘ë³µëœ order ê°’ì´ ë°œìƒí•˜ëŠ” ì§€ë¥¼ ê²€ìƒˆí•˜ì¤€ë‹¤.
    - product_line_factoryë¥¼ ì‚¬ìš©í•´ì„œ ìƒì„±í•œ ProductLine ê°ì²´ë“¤ ì¤‘ í˜„ì¬ ê°ì²´ order ê°’ì´ ìˆã…‡ì¦ ê²½ìš° ValidationError ì˜ˆì™¸ë¥¼ ë°œìƒí•˜ê³  í•´ë‹¹ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•œë‹¤. -> ProductLine ëª¨ë¸ì˜ í•„ë“œ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê³  ì¤‘ë³µëœ ê°’ì´ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
    - `pytest.raises(ValidationError)` ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ `ValidationError` ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
    - withì€ pytest ì—ì„œ ì—ì™¸ë¥¼ ê²€ì¦í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ì´ë‹¤. with ì„ ì‚¬ìš©í•´ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë”ë¼ë” ì˜ˆì™¸ë¥¼ ì •ë¦¬í•˜ê³  ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.     

### with
`with` êµ¬ë¬¸ì€ íŒŒì´ì¬ì—ì„œ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ìë¥¼ ì‚¬ìš©í•  ë•Œ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” êµ¬ë¬¸ì´ë‹¤. ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ìëŠ” ë¦¬ì†ŒìŠ¤ í• ë‹¹, ì •ë¦¬, ì—ëŸ¬ ì²˜ë¦¬ ë“±ê³¼ ê°™ì´ ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë™ì•ˆ ê´€ë ¨ëœ ì„¤ì •ì„ ì œê³µí•˜ê³  ì •ë¦¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤. `with` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ìë¥¼ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.     

ì¼ë°˜ì ì¸ `with` êµ¬ë¬¸ì˜ ì‚¬ìš©ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.     
```python
with ì»¨í…ìŠ¤íŠ¸_ê´€ë¦¬ì as ë³€ìˆ˜:
    # ì‘ì—… ìˆ˜í–‰
```

`ì»¨í…ìŠ¤íŠ¸_ê´€ë¦¬ì`ëŠ” `__enter__()`ì™€ `__exit__()` ë©”ì„œë“œë¥¼ êµ¬í˜„í•œ ê°ì²´ë‹¤. `as ë³€ìˆ˜` ë¶€ë¶„ì€ ì„ íƒì ìœ¼ë¡œ, ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ìì—ì„œ ë°˜í™˜ë˜ëŠ” ê°’ì„ ë³€ìˆ˜ì— í• ë‹¹í•  ìˆ˜ ìˆë‹¤.     

`with` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´ `__enter__()` ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì–´ ì„¤ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³ , `__exit__()` ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì–´ ì •ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. ë˜í•œ, ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `__exit__()` ë©”ì„œë“œì—ì„œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.     

ì˜ˆì‹œë¥¼ í†µí•´ `with` êµ¬ë¬¸ì˜ ì‚¬ìš©ë²•ì„ ì´í•´í•´ë³´ì. ê°€ì¥ ì¼ë°˜ì ì¸ ì˜ˆì‹œ ì¤‘ í•˜ë‚˜ëŠ” íŒŒì¼ì„ ì—´ê³  ì‘ì—…ì„ ìˆ˜í–‰í•œ í›„ íŒŒì¼ì„ ë‹«ëŠ” ê²ƒì´ë‹¤.         

```python
with open('file.txt', 'r') as file:
    data = file.read()
    # íŒŒì¼ ì‘ì—… ìˆ˜í–‰

# with ë¸”ë¡ì„ ë²—ì–´ë‚˜ë©´ íŒŒì¼ì€ ìë™ìœ¼ë¡œ ë‹«í˜

```
ìœ„ì˜ ì˜ˆì‹œì—ì„œ `open()` í•¨ìˆ˜ëŠ” íŒŒì¼ ê°ì²´ë¥¼ ë°˜í™˜í•˜ê³ , ì´ íŒŒì¼ ê°ì²´ëŠ” `__enter__()` ë©”ì„œë“œì™€ `__exit__()` ë©”ì„œë“œë¥¼ êµ¬í˜„í•œ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ìë‹¤. `with` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´ íŒŒì¼ì„ ì—´ê³  ì‘ì—…ì„ ìˆ˜í–‰í•œ í›„, `with` ë¸”ë¡ì„ ë²—ì–´ë‚˜ë©´ ìë™ìœ¼ë¡œ íŒŒì¼ì´ ë‹«íŒë‹¤.      

ë‹¤ë¥¸ ì˜ˆì‹œë¡œëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ë‹¤ë£¨ëŠ” ê²½ìš°ë¥¼ ë“¤ ìˆ˜ ìˆë‹¤:
```python
import sqlite3

with sqlite3.connect('database.db') as conn:
    cursor = conn.cursor()
    cursor.execute('SELECT * FROM table')
    # ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—… ìˆ˜í–‰

# with ë¸”ë¡ì„ ë²—ì–´ë‚˜ë©´ ì—°ê²°ì´ ìë™ìœ¼ë¡œ ë‹«í˜

```

ìœ„ì˜ ì˜ˆì‹œì—ì„œ `sqlite3.connect()` í•¨ìˆ˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ë°˜í™˜í•˜ê³ , ì´ ì—°ê²° ê°ì²´ëŠ” `__enter__()` ë©”ì„œë“œì™€ `__exit__()` ë©”ì„œë“œë¥¼ êµ¬í˜„í•œ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ìë‹¤. `with` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•œ í›„ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³ , `with` ë¸”ë¡ì„ ë²—ì–´ë‚˜ë©´ ìë™ìœ¼ë¡œ ì—°ê²°ì´ ë‹«íŒë‹¤.     

ì´ì™€ ê°™ì´, `with` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ìë¥¼ íš¨ìœ¨ì ì´ê³  ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ë¦¬ì†ŒìŠ¤ì˜ í• ë‹¹ ë° ì •ë¦¬ë¥¼ ìë™í™”í•  ìˆ˜ ìˆë‹¤.     


factories.py
![](https://i.imgur.com/NGSy5cD.png)



![](https://i.imgur.com/wHSCa1L.png)

### product_factory ë¥¼ ì‚¬ìš©í–ˆì„ ë•Œì™€ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì„ ë•Œì˜ ì˜ˆ

#### ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì„ ë•Œì˜ ê²½ìš°

```python
def test_duplicate_order_values():
    # 1. ì œí’ˆ ìƒì„±
    product = Product.objects.create(name="Product 1")

    # 2. ì¤‘ë³µëœ ì£¼ë¬¸ ìˆœì„œë¥¼ ê°€ì§€ëŠ” ìƒí’ˆ ë¼ì¸ ìƒì„±
    product_line1 = ProductLine.objects.create(order=1, product=product)
    product_line2 = ProductLine.objects.create(order=1, product=product)

    # í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸
    assert product_line1.order == 1
    assert product_line2.order == 1  # ì¤‘ë³µëœ ì£¼ë¬¸ ìˆœì„œê°€ ìƒì„±ë¨

```

#### ì‚¬ìš©í–ˆì„ ë•Œì˜ ê²½ìš°
```python
def test_duplicate_order_values(product_factory):
    # 1. ì œí’ˆ ìƒì„±
    product = product_factory()

    # 2. ì¤‘ë³µëœ ì£¼ë¬¸ ìˆœì„œë¥¼ ê°€ì§€ëŠ” ìƒí’ˆ ë¼ì¸ ìƒì„±
    product_line1 = ProductLine.objects.create(order=1, product=product)
    product_line2 = ProductLine.objects.create(order=1, product=product)

    # í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸
    assert product_line1.order == 1
    assert product_line2.order == 1  # ì¤‘ë³µëœ ì£¼ë¬¸ ìˆœì„œê°€ ìƒì„±ë¨

```


## Testing : API Client End to End testing

test_endpoints.py
```python
class TestProductEndpoints:
Â  Â  endpoint = "/api/product/"

Â  Â  def test_return_all_products(self, product_factory, api_client):
Â  Â  Â  Â  # Arrange
Â  Â  Â  Â  product_factory.create_batch(4)
Â  Â  Â  Â  # Act
Â  Â  Â  Â  response = api_client().get(self.endpoint)
Â  Â  Â  Â  # Assert

Â  Â  Â  Â  assert response.status_code == 200
Â  Â  Â  Â  assert len(json.loads(response.content)) == 4

Â  Â  def test_return_single_product_by_slug(self, product_factory, api_client):
Â  Â  Â  Â  obj = product_factory(slug="test-slug")
Â  Â  Â  Â  response = api_client().get(f"{self.endpoint}{obj.slug}/")
Â  Â  Â  Â  assert response.status_code == 200
Â  Â  Â  Â  assert len(json.loads(response.content)) == 1

Â  Â  def test_return_products_by_category_slug(
Â  Â  Â  Â  self, category_factory, product_factory, api_client
Â  Â  ):
Â  Â  Â  Â  obj = category_factory(slug="test-slug")
Â  Â  Â  Â  product_factory(category=obj)
Â  Â  Â  Â  response = api_client().get(f"{self.endpoint}category/{obj.slug}/")

Â  Â  Â  Â  assert response.status_code == 200
Â  Â  Â  Â  assert len(json.loads(response.content)) == 1
```

- `test_return_single_product_by_slug`: ìŠ¬ëŸ¬ê·¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹¨ì¼ ì œí’ˆì„ ë°˜í™˜í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ë‹¤. `product_factory`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¬ëŸ¬ê·¸ê°€ "test-slug"ì¸ ì œí’ˆì„ ìƒì„±í•˜ê³ , API í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ í•´ë‹¹ ìŠ¬ëŸ¬ê·¸ë¥¼ í¬í•¨í•œ ì—”ë“œí¬ì¸íŠ¸ì— GET ìš”ì²­ì„ ë³´ë‚¸ë‹¤. ì‘ë‹µ ìƒíƒœ ì½”ë“œê°€ 200ì¸ì§€ í™•ì¸í•˜ê³ , ì‘ë‹µ ë‚´ìš©ì˜ ê¸¸ì´ê°€ 1ì¸ì§€ í™•ì¸í•œë‹¤.
    
- `test_return_products_by_category_slug`: ì¹´í…Œê³ ë¦¬ ìŠ¬ëŸ¬ê·¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì œí’ˆì„ ë°˜í™˜í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ë‹¤. `category_factory`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¬ëŸ¬ê·¸ê°€ "test-slug"ì¸ ì¹´í…Œê³ ë¦¬ë¥¼ ìƒì„±í•˜ê³ , í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ì†í•˜ëŠ” ì œí’ˆì„ `product_factory`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•œë‹¤. API í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ìŠ¬ëŸ¬ê·¸ë¥¼ í¬í•¨í•œ ì—”ë“œí¬ì¸íŠ¸ì— GET ìš”ì²­ì„ ë³´ë‚¸ë‹¤. ì‘ë‹µ ìƒíƒœ ì½”ë“œê°€ 200ì¸ì§€ í™•ì¸í•˜ê³ , ì‘ë‹µ ë‚´ìš©ì˜ ê¸¸ì´ê°€ 1ì¸ì§€ í™•ì¸í•œë‹¤.

views.py

```python
class ProductViewSet(viewsets.ViewSet):
Â  Â  '''
Â  Â  A simple Viewset for viewing all products

Â  Â  '''
Â  Â  # queryset = Product.isactive.all()
Â  Â  queryset = Product.objects.all().isactive()
Â  Â  lookup_field = "slug"

Â  Â  def retrieve(self, request, slug=None):
Â  Â  Â  Â  serializer = ProductSerializer(
Â  Â  Â  Â  Â self.queryset.filter(slug=slug).select_related("category", "brand"),
Â  Â  Â  Â  Â  Â  many=True
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  data = Response(serializer.data)
Â  Â  Â  Â  queries = list(connection.queries)
Â  Â  Â  Â  print(len(queries))

Â  Â  Â  Â  for query in queries:
Â  Â  Â  Â  Â  Â  sqlformatted = format(str(query["sql"]), reindent=True)
Â  Â  Â  Â  Â  Â  print(highlight(sqlformatted, SqlLexer(), TerminalFormatter()))
Â  Â  Â  Â  return data

Â  Â  @extend_schema(responses=ProductSerializer)
Â  Â  def list(self, request):
Â  Â  Â  Â  serializer = ProductSerializer(self.queryset, many=True)
Â  Â  Â  Â  return Response(serializer.data)

Â  Â  @action(
Â  Â  Â  Â  methods=["get"],
Â  Â  Â  Â  detail=False,
Â  Â  Â  Â  url_path=r"category/(?P<slug>[\w-]+)",
Â  Â  Â  Â  )

Â  Â  def list_product_by_category_slug(self, request, slug=None):
Â  Â  Â  Â  '''
Â  Â  Â  Â  An endpoint to return products by category
Â  Â  Â  Â  '''

Â  Â  Â  Â  serializer = ProductSerializer(
Â  Â  Â  Â  Â  Â  self.queryset.filter(category__slug=slug), many=True
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  return Response(serializer.data)
```

ìŠ¬ëŸ¬ê·¸ ê°™ì€ ê²½ìš° - í˜¹ì€ _ ê°€ ì‚¬ìš©ë˜ë¯€ë¡œ ì •ê·œì‹ì„ `r"category/(?P<slug>[\w-]+)"` ì´ëŸ° ì‹ìœ¼ë¡œ ë°”ê¿”ì•¼ í•œë‹¤ \w ë§Œ ì‚¬ìš©í•  ê²½ìš° ì•ŒíŒŒë²³ê³¼ ìˆ«ìë§Œ í—ˆìš©ë˜ì„œ ì˜¤ë¥˜ê°€ ë‚œë‹¤.

[íŒŒì´ì¬ ì •ê·œì‹](https://docs.python.org/ko/3/howto/regex.html)
